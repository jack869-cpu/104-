<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>104åœ’éŠæœƒé ç´„ç³»çµ±</title>
  <style>
    /* =========================
       Mobile First è¨­è¨ˆ
       ========================= */
    :root{
      --bg:#0f172a;
      --panel:#111827;
      --primary:#22c55e;
      --secondary:#38bdf8;
      --danger:#ef4444;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --radius:14px;
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

    body{
      margin:0;
      min-height:100svh;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;
    }

    /* ===== Headerï¼ˆæ‰‹æ©Ÿå›ºå®šåœ¨ä¸Šæ–¹ï¼‰ ===== */
    header{
      position:sticky;
      top:0;
      z-index:10;
      background:rgba(2,6,23,.85);
      backdrop-filter: blur(10px);
      padding:12px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,.08);
    }

    header h1{
      font-size:16px;
      margin:0;
      font-weight:700;
    }

    .nav button{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.2);
      background:none;
      color:var(--text);
      font-size:14px;
    }
    .nav button.active{
      background:var(--secondary);
      color:#020617;
    }

    main{
      padding:16px;
    }

    .card{
      background:var(--panel);
      border-radius:var(--radius);
      padding:16px;
      margin-bottom:16px;
    }

    /* ===== é¡¯ç¤ºé ï¼ˆæ‰‹æ©Ÿæœ€é‡è¦ï¼‰ ===== */
    .display{
      text-align:center;
    }

    .display .label{
      font-size:14px;
      color:var(--muted);
      margin-bottom:8px;
    }

    .display .now{
      font-size:72px;
      font-weight:900;
      letter-spacing:4px;
      margin:8px 0 16px;
    }

    .queue{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:12px;
    }

    .badge{
      padding:12px 0;
      border-radius:999px;
      background:#020617;
      border:1px solid rgba(255,255,255,.15);
      font-size:20px;
      font-weight:700;
    }

    /* ===== ç™»å…¥ ===== */
    .login input{
      width:100%;
      padding:14px;
      font-size:16px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.2);
      background:#020617;
      color:var(--text);
    }

    .login button{
      width:100%;
      margin-top:12px;
      padding:14px;
      font-size:16px;
      font-weight:700;
      border-radius:12px;
      border:none;
      background:var(--secondary);
      color:#020617;
    }

    .error{color:var(--danger);margin-top:8px}

    /* ===== æ«ƒæª¯æ“ä½œï¼ˆå¤§æŒ‰éˆ•ï¼Œé©åˆè§¸æ§ï¼‰ ===== */
    .counter-actions{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }

    .btn{
      padding:18px;
      font-size:18px;
      font-weight:800;
      border-radius:14px;
      border:none;
    }

    .btn.primary{background:var(--primary);color:#052e16}
    .btn.secondary{background:var(--secondary);color:#020617}
    .btn.danger{background:var(--danger);color:#020617}

    .stats{
      margin-top:16px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }

    .stat{
      background:#020617;
      border-radius:12px;
      padding:12px;
      text-align:center;
    }

    .stat h3{
      margin:0;
      font-size:12px;
      color:var(--muted);
    }

    .stat p{
      margin:6px 0 0;
      font-size:24px;
      font-weight:800;
    }

    footer{
      text-align:center;
      font-size:12px;
      color:var(--muted);
      padding:16px 0 24px;
    }

    /* ===== å¹³æ¿ / æ¡Œæ©Ÿæ‰æ”¾å¤§ ===== */
    @media (min-width:768px){
      main{max-width:900px;margin:auto}
      .display .now{font-size:96px}
      .queue{grid-template-columns:repeat(6,1fr)}
      .counter-actions{grid-template-columns:repeat(3,1fr)}
      .stats{grid-template-columns:repeat(3,1fr)}
    }
  </style>
</head>
<body>
  <!-- JS èˆ‡ HTML çµæ§‹ç¶­æŒåŸæœ¬ï¼Œä¸å½±éŸ¿åŠŸèƒ½ -->
   <header>
  <h1>104åœ°é¼ é ç´„å«è™Ÿç³»çµ±</h1>
  <div class="nav">
    <button id="nav-display" class="active">é¡¯ç¤º</button>
    <button id="nav-counter">æ«ƒæª¯</button>
  </div>
</header>

<main>
  <!-- ===== é¡¯ç¤ºé  ===== -->
  <section id="page-display" class="card display">
    <div class="label">ç›®å‰å«è™Ÿ</div>
    <div id="nowNumber" class="now">â€”</div>

    <div class="label">ç­‰å¾…ä¸­</div>
    <div id="waitingList" class="queue"></div>
  </section>

  <!-- ===== ç™»å…¥é  ===== -->
  <section id="page-login" class="card login" style="display:none">
    <input id="password" type="password" placeholder="è«‹è¼¸å…¥æ«ƒæª¯å¯†ç¢¼">
    <button id="loginBtn">ç™»å…¥æ«ƒæª¯</button>
    <div id="loginError" class="error"></div>
  </section>

  <!-- ===== æ«ƒæª¯ç®¡ç†ä»‹é¢ ===== -->
  <section id="page-counter" class="card" style="display:none">


    <!-- æ“ä½œæŒ‰éˆ• -->
    <div class="counter-actions">
      <button id="addNumber" class="btn primary">æ–°å¢è™Ÿç¢¼</button>
      <button id="callNext" class="btn secondary">å«ä¸‹ä¸€è™Ÿ</button>
      <button id="resetAll" class="btn danger">å…¨éƒ¨é‡ç½®</button>
    </div>

    <!-- ğŸ”´ åˆªé™¤è™Ÿç¢¼ -->
    <div class="card">
      <h3>åˆªé™¤ç­‰å¾…ä¸­çš„è™Ÿç¢¼</h3>
      <input id="deleteNumber" type="number" placeholder="è¼¸å…¥è¦åˆªé™¤çš„è™Ÿç¢¼">
      <button id="deleteNumberBtn" class="btn danger">åˆªé™¤è™Ÿç¢¼</button>
    </div>

    <!-- ğŸŸ¢ å›å¾©è™Ÿç¢¼ -->
    <div class="card">
      <h3>å›å¾©èª¤åˆªçš„è™Ÿç¢¼</h3>
      <input id="restoreNumber" type="number" placeholder="è¼¸å…¥è¦å›å¾©çš„è™Ÿç¢¼">
      <button id="restoreNumberBtn" class="btn primary">å›å¾©è™Ÿç¢¼</button>
    </div>

    <!-- ç‹€æ…‹ -->
    <div class="stats">
      <div class="stat">
        <h3>ç›®å‰å«è™Ÿ</h3>
        <p id="statCurrent">â€”</p>
      </div>
      <div class="stat">
        <h3>ç­‰å¾…äººæ•¸</h3>
        <p id="statWaiting">0</p>
      </div>
      <div class="stat">
        <h3>æœ€å¾Œè™Ÿç¢¼</h3>
        <p id="statLast">0</p>
      </div>
    </div>

  </section>
</main>

 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCDcLUp0hPrRIPDqV7nEGIY_p3547ol3EQ",
    authDomain: "food-ad3d0.firebaseapp.com",
    projectId: "food-ad3d0",
    storageBucket: "food-ad3d0.firebasestorage.app",
    messagingSenderId: "1098582550820",
    appId: "1:1098582550820:web:92450df87636f18979ebb1",
    measurementId: "G-76JKJ8W3B2"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  const state = {
    current: null,
    last: 0,
    queue: [],
    called: []
  };

  const stateDoc = doc(db, "queueState", "main");

  async function saveToFirebase() {
    await setDoc(stateDoc, state);
  }

  function render() {
    document.getElementById('nowNumber').textContent = state.current ?? 'â€”';
    document.getElementById('statCurrent').textContent = state.current ?? 'â€”';
    document.getElementById('statWaiting').textContent = state.queue.length;
    document.getElementById('statLast').textContent = state.last;

    const list = document.getElementById('waitingList');
    list.innerHTML = '';
    if(state.queue.length === 0){
      const empty = document.createElement('div');
      empty.className = 'badge';
      empty.textContent = 'ç­‰å¾…ä¸­â€¦';
      list.appendChild(empty);
    } else {
      state.queue.slice(0,6).forEach(n=>{
        const b = document.createElement('div');
        b.className = 'badge';
        b.textContent = n;
        list.appendChild(b);
      });
    }
  }

  // å³æ™‚åŒæ­¥
  onSnapshot(stateDoc, (docSnap)=>{
    if(docSnap.exists()){
      Object.assign(state, docSnap.data());
      render();
    }
  });

  document.getElementById('addNumber').onclick = async ()=>{
    state.last++;
    state.queue.push(state.last);
    await saveToFirebase();
  };

  document.getElementById('callNext').onclick = async ()=>{
    if(state.queue.length === 0){ alert('ç›®å‰æ²’æœ‰ç­‰å¾…è™Ÿç¢¼'); return; }
    const next = state.queue.shift();
    state.current = next;
    state.called.push(next);
    await saveToFirebase();
  };

  document.getElementById('resetAll').onclick = async ()=>{
    if(confirm('ç¢ºå®šå…¨éƒ¨é‡ç½®ï¼Ÿ')){
      state.current=null;
      state.last=0;
      state.queue=[];
      state.called=[];
      await saveToFirebase();
    }
  };

  document.getElementById('deleteNumberBtn').onclick = async ()=>{
    const n = parseInt(document.getElementById('deleteNumber').value);
    if(!state.queue.includes(n)){ alert('æ­¤è™Ÿç¢¼ä¸åœ¨ç­‰å¾…ä¸­'); return; }
    state.queue = state.queue.filter(x=>x!==n);
    await saveToFirebase();
  };

  document.getElementById('restoreNumberBtn').onclick = async ()=>{
    const n = parseInt(document.getElementById('restoreNumber').value);
    if(state.queue.includes(n) || state.called.includes(n)){
      alert('âš ï¸ æ­¤è™Ÿç¢¼å·²å­˜åœ¨ï¼Œé¿å…é‡è¤‡å«è™Ÿ'); return;
    }
    state.queue.unshift(n);
    await saveToFirebase();
  };

  const pageDisplay=document.getElementById('page-display');
  const pageLogin=document.getElementById('page-login');
  const pageCounter=document.getElementById('page-counter');

  function show(p){
    pageDisplay.style.display='none';
    pageLogin.style.display='none';
    pageCounter.style.display='none';
    p.style.display='block';
  }

  document.getElementById('nav-display').onclick=()=>show(pageDisplay);
  document.getElementById('nav-counter').onclick=()=>show(pageLogin);

  const ADMIN_PASSWORD = '0803';/////////////////////////////////////////////////å¯†ç¢¼
  document.getElementById('loginBtn').onclick=()=>{
    if(document.getElementById('password').value===ADMIN_PASSWORD){
      show(pageCounter);
    } else {
      document.getElementById('loginError').textContent='å¯†ç¢¼éŒ¯èª¤';
    }
  };

  render();
</script>



</body>
</html>

